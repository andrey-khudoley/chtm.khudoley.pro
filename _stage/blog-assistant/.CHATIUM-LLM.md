# Персональный блог на Chatium

## Версия 1.5
**Что изменилось**: Полная совместимость с Telegram Instant View:
- Контент рендерится в чистый HTML (используется `<raw-html>` вместо JSX-элементов)
- Функция `markdownToHtml` конвертирует маркдаун в семантические HTML-теги
- Все теги соответствуют спецификации IV: `<article>`, `<h1>`, `<h2>`, `<h3>`, `<p>`, `<ul>`, `<ol>`, `<time datetime>`, `<figure>`, `<address class="author">`
- Добавлено экранирование HTML для безопасности
- Исправлен парсинг курсива и жирного текста через регулярные выражения
- Open Graph теги с абсолютными URL
- Canonical URL для правильной индексации

## Структура проекта

### Основные файлы
- `index.tsx` - главная страница блога со списком постов
- `profile.tsx` - страница профиля пользователя (авторизация + редактирование)
- `post.tsx` - страница отдельного поста
- `mini.tsx` - страница для Telegram mini-app и Instant View (упрощенная мобильная версия)
- `admin.tsx` - админка для управления постами (только для админов)

### Компоненты страниц
- `pages/BlogHomePage.vue` - главная страница с лентой постов
- `pages/BlogPostPage.vue` - страница просмотра отдельного поста
- `pages/BlogAdminPage.vue` - админка для создания/редактирования постов
- `pages/EditPostPage.vue` - отдельная страница редактирования поста с websocket-обновлениями
- `pages/ProfilePage.vue` - страница профиля пользователя

### API
- `api/blog.ts` - все API endpoints для работы с постами:
  - GET `/list` - получение опубликованных постов
  - GET `/post/:slug` - получение поста по slug
  - GET `/all` - получение всех постов (для админки)
  - GET `/settings` - получение настроек блога
  - POST `/settings` - сохранение настроек блога
  - POST `/create` - создание нового поста
  - GET `/post-by-id/:id` - получение поста по ID (для редактирования)
  - POST `/update/:id` - обновление поста
  - POST `/delete/:id` - удаление поста
  - POST `/generate` - генерация поста с помощью ИИ (черновик)
  - POST `/publish` - генерация и публикация поста с помощью ИИ (сразу опубликованный)
- `api/profile.ts` - API endpoints для работы с профилем:
  - POST `/update` - обновление профиля пользователя

- `api/comments.ts` - API endpoints для работы с комментариями:
  - GET `/list/:postId` - получение комментариев к посту
  - POST `/create` - создание нового комментария
  - POST `/delete/:id` - удаление комментария (только для админов)

### Таблицы
- `tables/posts.table` - таблица постов блога со следующими полями:
  - title: заголовок поста
  - slug: URL-адрес поста
  - content: содержимое поста
  - excerpt: краткое описание
  - coverImage: обложка поста (ImageFileKind)
  - published: статус публикации
  - publishedAt: дата публикации
  - tags: теги через запятую
  - readingTime: время чтения в минутах

- `tables/blogSettings.table` - таблица настроек блога:
  - key: ключ настройки (например: `systemPrompt`, `blogAuthor`)
  - value: значение настройки
  - description: описание настройки

- `tables/comments.table` - таблица комментариев к постам:
  - postId: ID поста
  - userId: ID пользователя-автора комментария
  - content: текст комментария
  - authorName: имя автора комментария

## Контент

### Созданные посты
- **"Магия вайб-кодинга: когда код становится искусством"** (slug: `magiya-vayb-kodinga`)
  - ID: `rEu2nWhd3JO3Kfp5Bj50timur`
  - Опубликован: 2025-07-19T17:44:15.802Z
  - Теги: программирование, вдохновение, продуктивность, философия, разработка
  - Большой пост о философии и практике вайб-кодинга от лица Chatium

## Функционал

### Для посетителей
- Просмотр списка опубликованных постов
- Чтение отдельных постов
- Просмотр комментариев к постам
- Добавление комментариев (для авторизованных пользователей)
- Поиск по тегам
- Социальные кнопки для шаринга
- Авторизация через страницу профиля
- Просмотр и редактирование профиля:
  - Имя и фамилия
  - Пол и дата рождения
  - Просмотр подтвержденного email/телефона
- Адаптивный дизайн
- Просмотр постов в Telegram mini-app и Instant View

### Для администраторов
- Создание новых постов
- Редактирование существующих постов
- Управление статусом публикации
- Удаление постов
- Просмотр всех постов (включая черновики)
- Генерация постов с помощью ИИ по заданной теме (черновик)
- Генерация и публикация постов с помощью ИИ в один клик
- Удаление комментариев
- Редактирование системного промпта для ИИ-генерации
- Отдельная страница редактирования с реальными обновлениями статуса генерации через websocket
- Упрощенная форма генерации постов с ИИ на главной странице (без отображения системного промпта)
- Копирование ссылки для встраивания в Telegram (mini-app версия)
- Быстрый доступ к mini-app версии поста из списка постов

## Дизайн
- Использует Tailwind CSS
- Адаптивный дизайн
- Современный минималистичный стиль
- Иконки FontAwesome
- Шрифт Inter
- Специальная оптимизация для Telegram mini-app

## Авторизация
- Админка доступна только пользователям с ролью Admin
- Профиль пользователя с редактированием основных данных
- Обычные посетители могут только читать посты

## ИИ-генерация
- Использует `@start/sdk` для генерации контента
- Два режима генерации:
  - **Черновик** (кнопка "Написать пост") - создает черновик с пользовательским системным промптом
  - **Публикация** (кнопка "Опубликовать пост") - склеивает пользовательский промпт с промптом публикации (`getPublishSystemPrompt`) и сразу публикует пост
- Автоматически парсит заголовок, теги и краткое описание из ответа ИИ
- Системный промпт настраивается через админку
- Время чтения рассчитывается автоматически при создании/обновлении постов
- При генерации поста пользователь перенаправляется на отдельную страницу редактирования
- Статус генерации обновляется в реальном времени через websocket
- Используется socketId в формате `post-edit-{postId}` для websocket-соединений
- Промпт публикации проверяет орфографию и подготавливает контент к публикации без изменения содержания

## Websocket-обновления
- Используется модуль `@app/socket` для реального времени обновлений
- При ИИ-генерации статус обновляется через websocket на странице редактирования
- Типы сообщений: `generation-status` с полями `generating`, `message`, `post`
- Socket ID генерируется на сервере и передается в закодированном виде на клиент

## Telegram интеграция
- Страница `mini.tsx` оптимизирована для Telegram mini-app и Instant View
- Автоматическое распознавание Telegram mini-app окружения
- Запрос разрешения на отправку сообщений ботом при запуске mini-app
- Поддержка Telegram WebApp SDK
- Адаптивная тема для Telegram
- Поддержка safe-area для корректного отображения на разных устройствах
- **Полная совместимость с Telegram Instant View**:
  - Семантическая HTML-структура (`<article>`, `<h1>`, `<time datetime>`, `<figure>`)
  - Абсолютные URL в Open Graph тегах
  - Мета-теги для автора, даты публикации, тегов
  - Canonical URL
- Упрощенный интерфейс для мобильных устройств
- Кнопка копирования ссылки для встраивания в Telegram в админке

## Изменения в коде
- Заменены все абсолютные URL на относительные пути
- Убраны хардкод имена и заменены на "Название блога"
- Везде используются импортированные роуты из API файлов
- Убраны неиспользуемые скрипты метрики
- Форма с главной страницы удалена, оставлена только в админке
- Добавлена поддержка mini-app с Telegram WebApp SDK
